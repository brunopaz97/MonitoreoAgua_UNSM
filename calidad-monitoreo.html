<!DOCTYPE html>
    <html lang="en">

    <head>
        <meta charset="utf-8">
        <title>Monitoreo Agua</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description">
        <meta content="Coderthemes" name="author">

        

        <script type="text/javascript">
        
        </script>

        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/logo-inictel.ico">
        
        <!-- third party css -->
        <link href="assets/css/vendor/jquery-jvectormap-1.2.2.css" rel="stylesheet" type="text/css">
        <!-- third party css end -->

        <!-- App css -->
        <link href="assets/css/style.css" rel="stylesheet" type="text/css">
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <link href="assets/css/app.min.css" rel="stylesheet" type="text/css" id="light-style">
        <link href="assets/css/app-dark.min.css" rel="stylesheet" type="text/css" id="dark-style">

        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin=""/>
        <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>

        <!--Ajax de Leaflet-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js" integrity="sha512-Abr21JO2YqcJ03XGZRPuZSWKBhJpUAR6+2wH5zBeO4wAw4oksr8PRdF+BKIRsxvCdq+Mv4670rZ+dLnIyabbGw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.js" integrity="sha512-eYE5o0mD7FFys0tVot8r4AnRXzVVXhjVpzNK+AcHkg4zNLvUAaCOJyLFKjmfpJMj6L/tuCzMN7LULBvNDhy5pA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        
        <script src="https://code.highcharts.com/highcharts.js"></script>
        <script src="https://code.highcharts.com/modules/accessibility.js"></script>
        <link rel="stylesheet" href="https://code.highcharts.com/css/highcharts.css">
        

    </head>

    <body class="loading" data-layout-config='{"leftSideBarTheme":"dark","layoutBoxed":false, "leftSidebarCondensed":false, "leftSidebarScrollable":false,"darkMode":false, "showRightSidebarOnStart": true}'>
        <!-- Begin page -->
        <div class="wrapper">
            <!-- ========== Left Sidebar Start ========== -->
            <div class="leftside-menu">
    
                <!-- LOGO -->
                <a href="index.html" class="logo text-center logo-light">
                    <span class="logo-lg">
                        <img src="assets/images/logoproyec.png" alt="" height="54">
                    </span>
                    <span class="logo-sm">
                        <img src="assets/images/logoproyec.png" alt="" height="16">
                    </span>
                </a>

                <!-- LOGO -->
                <a href="index.html" class="logo text-center logo-dark">
                    <span class="logo-lg">
                        <img src="assets/images/logoproyec.png" alt="" height="16">
                    </span>
                    <span class="logo-sm">
                        <img src="assets/images/logoproyec.png" alt="" height="16">
                    </span>
                </a>
    
                <div class="h-100" id="leftside-menu-container" data-simplebar="">

                    <!--- Sidemenu -->
                    <!--- Sidemenu -->
                    <ul class="side-nav">

                        <li class="side-nav-title side-nav-item">Navegación</li>

                        <li class="side-nav-item menuitem-active">
                            <a href="index.html" class="side-nav-link active">
                                <i class="uil-home-alt"></i>
                                <span> Inicio </span>
                            </a>
                        </li>
                        <hr style="height: 3px;">
                        <li class="side-nav-item">
                            <a data-bs-toggle="collapse" href="#sidebarProduccion" aria-expanded="false" aria-controls="sidebarProduccion" class="side-nav-link">
                                <img src="assets/images/icons_agua/produccion.svg">
                                <span> &nbsp &nbsp Fase de Producción </span>
                                <span class="menu-arrow"></span>
                            </a>
                            <div class="collapse" id="sidebarProduccion">
                                <ul class="side-nav-second-level">
                                    <li>
                                        <a href="produc-formula.html">Formulario</a>
                                    </li>
                                    <!--
                                    <li>
                                        <a href="#">Estadísticas</a>
                                    </li>
                                    -->
                                </ul>
                            </div>

                            <!-- Opcion Activa IMPORTANTE
                            <ul class="side-nav-second-level">
                                    <li class="menuitem-active">
                                        <a href="apps-ecommerce-products.html" class="active">Products</a>
                                    </li>
                                    <li>
                                        <a href="apps-ecommerce-products-details.html">Products Details</a>
                                    </li>
                                    <li>
                                        <a href="apps-ecommerce-orders.html">Orders</a>
                                    </li>
                                    <li>
                                        <a href="apps-ecommerce-orders-details.html">Order Details</a>
                                    </li>
                                    <li>
                                        <a href="apps-ecommerce-customers.html">Customers</a>
                                    </li>
                                    <li>
                                        <a href="apps-ecommerce-shopping-cart.html">Shopping Cart</a>
                                    </li>
                                    <li>
                                        <a href="apps-ecommerce-checkout.html">Checkout</a>
                                    </li>
                                    <li>
                                        <a href="apps-ecommerce-sellers.html">Sellers</a>
                                    </li>
                                </ul>
                            -->

                        </li>

                        <li class="side-nav-item">
                            <a data-bs-toggle="collapse" href="#sidebarCalidad" aria-expanded="false" aria-controls="sidebarCalidad" class="side-nav-link">
                                <img src="assets/images/icons_agua/calidad.svg">
                                <span> &nbsp &nbsp Calidad de Agua </span>
                                <span class="menu-arrow"></span>
                            </a>
                            <div class="collapse" id="sidebarCalidad">
                                <ul class="side-nav-second-level">
                                    <li>
                                        <a href="calidad-monitoreo.html">Monitoreo</a>
                                    </li>
                                    <!--
                                    <li>
                                        <a href="#">Márgenes</a>
                                    </li>
                                    <li>
                                        <a href="#">Eventos</a>
                                    </li>
                                    -->
                                </ul>
                            </div>
                        </li>

                        <li class="side-nav-item">
                            <a data-bs-toggle="collapse" href="#sidebarAlimentacion" aria-expanded="false" aria-controls="sidebarAlimentacion" class="side-nav-link">
                                <img src="assets/images/icons_agua/alimentacion.svg">
                                <span> &nbsp &nbsp Alimentación </span>
                                <span class="menu-arrow"></span>
                            </a>
                            <div class="collapse" id="sidebarAlimentacion">
                                <ul class="side-nav-second-level">
                                    <li>
                                        <a href="alimentacion-formula.html">Formulario</a>
                                    </li>
                                    <li>
                                        <a href="alimentacion-estadisticas.html">Estadísticas</a>
                                    </li>
                                </ul>
                            </div>
                        </li>

                        <li class="side-nav-item">
                            <a data-bs-toggle="collapse" href="#sidebarReportes" aria-expanded="false" aria-controls="sidebarReportes" class="side-nav-link">
                                <img src="assets/images/icons_agua/reportes.svg">
                                <span> &nbsp &nbsp Reportes </span>
                                <span class="menu-arrow"></span>
                            </a>
                            <div class="collapse" id="sidebarReportes">
                                <ul class="side-nav-second-level">
                                    <!--
                                    <li>
                                        <a href="#">Historial</a>
                                    </li>
                                    -->
                                </ul>
                            </div>
                        </li>
                    </ul>

                    <!-- Help Box
                    <div class="help-box text-white text-center">
                        <a href="javascript: void(0);" class="float-end close-btn text-white">
                            <i class="mdi mdi-close"></i>
                        </a>
                        <img src="assets/images/help-icon.svg" height="90" alt="Helper Icon Image">
                        <h5 class="mt-3">Unlimited Access</h5>
                        <p class="mb-3">Upgrade to plan to get access to unlimited reports</p>
                        <a href="javascript: void(0);" class="btn btn-outline-light btn-sm">Upgrade</a>
                    </div>
                    end Help Box -->
                    <!-- End Sidebar -->

                    <div class="clearfix"></div>

                </div>
                <!-- Sidebar -left -->

            </div>
            <!-- Left Sidebar End -->

            <!-- ============================================================== -->
            <!-- Start Page Content here -->
            <!-- ============================================================== -->

            <div class="content-page">
                <div class="content">
                    <!-- Topbar Start -->
                    <div class="navbar-custom">
                        <ul class="list-unstyled topbar-menu float-end mb-0">
                            <li class="dropdown notification-list">
                                <a class="nav-link dropdown-toggle nav-user arrow-none me-0" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
                                    <span class="account-user-avatar"> 
                                        <img src="assets/images/users/avatar-1.jpg" alt="user-image" class="rounded-circle">
                                    </span>
                                    <span>
                                        <span class="account-user-name">Enrique Paz</span>
                                        <span class="account-position">Administrador</span>
                                    </span>
                                </a>
                                <div class="dropdown-menu dropdown-menu-end dropdown-menu-animated topbar-dropdown-menu profile-dropdown">
                                    <!-- item-->
                                    <div class=" dropdown-header noti-title">
                                        <h6 class="text-overflow m-0">Bienvenido !</h6>
                                    </div>

                                    <!-- item-->
                                    <a href="javascript:void(0);" class="dropdown-item notify-item">
                                        <i class="mdi mdi-account-circle me-1"></i>
                                        <span>Mi Cuenta</span>
                                    </a>

                                    <!-- item-->
                                    <a href="javascript:void(0);" class="dropdown-item notify-item">
                                        <i class="mdi mdi-chat-processing-outline me-1"></i>
                                        <span>Soporte</span>
                                    </a>

                                    <!-- item-->
                                    <a href="javascript:void(0);" class="dropdown-item notify-item">
                                        <i class="mdi mdi-logout me-1"></i>
                                        <span>Cerrar Sesión</span>
                                    </a>
                                </div>
                            </li>
                        </ul>
                        <button class="button-menu-mobile open-left">
                            <i class="mdi mdi-menu"></i>
                        </button>
                    </div>
                    <!-- end Topbar -->
                    
                    <!-- Start Content-->
                    <div class="container-fluid">


                        <div class="row">
                            <div class="col-4">
                                <div class="page-title-box">
                                    <h4 class="page-title">Piscigranja 1</h4>
                                    <h5>Elige parámetro ambiental</h5>

                                    <select id="selector" class="form-control select2" data-toggle="select2">
                                        <option value="">Seleccione</option>
                                        <option value="temp">Temperatura</option>
                                        <option value="oxig">Oxigeno Disuelto</option>
                                        <option value="ph">Ph</option>
                                        <!--
                                        <option value="tds">Solidos Disueltos Totales</option>
                                        <option value="nh3">Nitrogeno Amoniacal NH3-N</option>
                                        <option value="no3">Ion de Nitrato NO3-</option>
                                        <option value="turb">Turbidez</option>
                                        <option value="dur">Dureza</option>
                                        -->
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-1"></div>
                            <div class="col-md-3">
                                <br>
                                <br>
                                <div class="card widget-flat">
                                    <div class="card-body card-datos">                                        
                                        <h4 class="text-muted fw-normal mt-0" title="Cantidad de peces">Cantidad de registros</h4>
                                        <h3 class="cant-registros" style="text-align: center;">0</h3>
                                        <h4 class="text-muted fw-normal mt-0" title="Cantidad de peces">Fecha de último registro</h4>
                                        <h3 class="fecha-registro" style="text-align: center;">0</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-1"></div>
                            <div class="col-md-6">
                                <p style="text-align: center; font-size: x-large;">Ubicación</p>
                                <div id="map" style="width: 630px; height: 190px;"></div>
                            </div>
                        </div>
                        <!-- end row -->

                        <div class="row"></div>
                        <br>
                        <div class="row">
                            <div class="col-md-1"></div>
                            <div class="col-md-3">
                                <p style="text-align: center; font-size:x-large;">Último Registro</p>
                                <div id="gauge" style="width:250px; margin: 0 auto;"></div>
                            </div>
                            <div class="col-md-1"></div>
                            <div class="col-md-6">
                                <p style="text-align: center; font-size:x-large;">Historial de Registros</p>
                                <div id="datagrama" style="width: 630px; height: 250px;"></div>
                                
                                
                                
                            </div>
                        </div>
                        <!-- end row -->

                    </div>
                    <!-- container -->

                </div>
                <!-- content -->

                <!-- Footer Start -->
                <footer class="footer">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-md-6">
                                <script>document.write(new Date().getFullYear())</script> © INICTEL-UNI - UNSM
                            </div>
                        </div>
                    </div>
                </footer>
                <!-- end Footer -->

            </div>

            <!-- ============================================================== -->
            <!-- End Page content -->
            <!-- ============================================================== -->


        </div>
        <!-- END wrapper -->
        
        <!-- Indicadores -->
        <script src="assets/js/loader.js"></script>
        
        <script>
            $(document).ready(function () {

                setInterval(actualizar_datos, 3000);
               
                var intervalDatagrama;
                var intervalGauge;
               
                $('#selector').on('change', function() {
                    var seleccion = $(this).val();
                    // Detener los intervalos anteriores
                    clearInterval(intervalDatagrama);
                    clearInterval(intervalGauge);
                  
                    if (seleccion === 'temp') {
                        intervalDatagrama = setInterval(actualizar_datagrama_temp, 3000);
                        intervalGauge = setInterval(actualizar_gauge_temp, 3000);
                    } else if (seleccion === 'oxig') {
                        intervalDatagrama = setInterval(actualizar_datagrama_od, 3000);
                        intervalGauge = setInterval(actualizar_gauge_od, 3000);
                    } else if (seleccion === 'ph') {
                        intervalDatagrama = setInterval(actualizar_datagrama_ph, 3000);
                        intervalGauge = setInterval(actualizar_gauge_ph, 3000);
                    }
                });
              
                // Cargar los datos iniciales de temperatura al cargar la página
                //setInterval(actualizar_datagrama_temp, 3000);
                //setInterval(actualizar_gauge_temp, 3000);
        
            });
            
            function actualizar_datagrama_temp(){
                $.ajax({
                url: 'monitoreo_php/datagramatemp.php',
                dataType: 'json',
                success: function (data) {
                    // Extrae los datos de temperatura y humedad de la respuesta JSON
                    var tempData = [];
                    var fechaData = [];
                    for (var i = 0; i < data.length; i++) {
                    tempData.push([data[i].fecha, parseFloat(data[i].temperatura)]);
                    fechaData.push(data[i].fecha);
                    }
                    
                    var chartT = new Highcharts.Chart({
                    chart:{ 
                        renderTo : 'datagrama',
                        defaultSeriesType: 'spline'},
                    title: { text: '' },
                    series: [{
                        name: 'Temperatura',
                        data: tempData,
                        yAxis: 0
                    }],
                    plotOptions: {
                        line: { animation: false,
                        dataLabels: { enabled: false }
                        },
                        series: { color: '#CD5C5C' }
                    },
                    xAxis: { 
                        type: 'datetime',
                        categories: fechaData,
                        reversed: true,
                        visible: false
                    },
                    yAxis: {
                        title: { text: 'Temperatura (°C)' }
                    },
                    credits: { enabled: false }
                    });
                }
                });
            }
            
            function actualizar_gauge_temp() {
              google.charts.load('current', {
                packages: ['gauge']
              }).then(function () {
                var options = {
                  width: 800,
                  height: 240,
                  max: 40,
                  min: 10,
                  redFrom: 30,
                  redTo: 40,
                  greenColor: "#4AD352",
                  greenFrom: 15,
                  greenTo: 30,
                  yellowFrom: 10,
                  yellowTo: 15,
                  minorTicks: 40
                };
            
                var chart = new google.visualization.Gauge(document.getElementById('gauge'));
            
                drawChart();
            
                function drawChart() {
                  $.ajax({
                    url: 'monitoreo_php/gaugetemp.php',
                    dataType: 'json'
                  }).done(function (jsonData) {
                    // Utilizar la respuesta de PHP para crear la tabla de datos
                    var data = google.visualization.arrayToDataTable(jsonData);
                    chart.draw(data, options);
            
                    // Dibujar nuevamente en 5 segundos
                    window.setTimeout(drawChart, 2000);
                  });
                }
              });
            }
            
            function actualizar_datagrama_od(){
                $.ajax({
                url: 'monitoreo_php/datagramaod.php',
                dataType: 'json',
                success: function (data) {
                    // Extrae los datos de temperatura y humedad de la respuesta JSON
                    var odData = [];
                    var fechaData = [];
                    for (var i = 0; i < data.length; i++) {
                    odData.push([data[i].fecha, parseFloat(data[i].oxig_dis)]);
                    fechaData.push(data[i].fecha);
                    }
                    
                    var chartT = new Highcharts.Chart({
                    chart:{ 
                        renderTo : 'datagrama',
                        defaultSeriesType: 'spline'},
                    title: { text: '' },
                    series: [{
                        name: 'Oxigeno Disuelto',
                        data: odData,
                        yAxis: 0
                    }],
                    plotOptions: {
                        line: { animation: false,
                        dataLabels: { enabled: false }
                        },
                        series: { color: '#3498DB' }
                    },
                    xAxis: { 
                        type: 'datetime',
                        categories: fechaData,
                        reversed: true,
                        visible: false
                    },
                    yAxis: {
                        title: { text: 'Oxígeno Disuelto (mg/L)' }
                    },
                    credits: { enabled: false }
                    });
                }
                });
            }
            
            function actualizar_gauge_od() {
              google.charts.load('current', {
                packages: ['gauge']
              }).then(function () {
                var options = {
                  width: 800, height: 240,
                  max: 100, min: 0,
                  redFrom: 90, redTo: 100,
                  yellowColor: "#84A3D2",
                  greenColor: "#637A9E",
                  redColor: "#425269",
                  greenFrom: 25, greenTo:90,
                  yellowFrom: 0, yellowTo: 25,
                  minorTicks: 40
                };
            
                var chart = new google.visualization.Gauge(document.getElementById('gauge'));
            
                drawChart();
            
                function drawChart() {
                  $.ajax({
                    url: 'monitoreo_php/gaugeod.php',
                    dataType: 'json'
                  }).done(function (jsonData) {
                    // Utilizar la respuesta de PHP para crear la tabla de datos
                    var data = google.visualization.arrayToDataTable(jsonData);
                    chart.draw(data, options);
            
                    // Dibujar nuevamente en 5 segundos
                    window.setTimeout(drawChart, 2000);
                  });
                }
              });
            }
            
            function actualizar_datagrama_ph(){
                $.ajax({
                url: 'monitoreo_php/datagramaph.php',
                dataType: 'json',
                success: function (data) {
                    // Extrae los datos de temperatura y humedad de la respuesta JSON
                    var phData = [];
                    var fechaData = [];
                    for (var i = 0; i < data.length; i++) {
                    phData.push([data[i].fecha, parseFloat(data[i].ph)]);
                    fechaData.push(data[i].fecha);
                    }
                    
                    var chartT = new Highcharts.Chart({
                    chart:{ 
                        renderTo : 'datagrama',
                        defaultSeriesType: 'spline'},
                    title: { text: '' },
                    series: [{
                        name: 'pH',
                        data: phData,
                        yAxis: 0
                    }],
                    plotOptions: {
                        line: { animation: false,
                        dataLabels: { enabled: false }
                        },
                        series: { color: '#3498DB' }
                    },
                    xAxis: { 
                        type: 'datetime',
                        categories: fechaData,
                        reversed: true,
                        visible: false
                    },
                    yAxis: {
                        title: { text: 'pH' }
                    },
                    credits: { enabled: false }
                    });
                }
                });
            }
            
            function actualizar_gauge_ph(){
                google.charts.load('current', {
                packages: ['gauge']
                }).then(function () {
                    var options = {
                        width: 800, height: 240,
                        max: 14, min: 0,
                        greenColor: "#BEEEFC",
                        yellowColor: "#7DDDF8",
                        redColor: "#51D1F6",
                        greenFrom: 0, greenTo: 6.5,
                        yellowFrom: 6.5, yellowTo: 8.5,
                        redFrom: 7.5, redTo: 14,
                        minorTicks: 40
                };
        
                var chart = new google.visualization.Gauge(document.getElementById('gauge'));
        
                drawChart();
        
                function drawChart() {
                  $.ajax({
                    url: 'monitoreo_php/gaugeph.php',
                    dataType: 'json'
                  }).done(function (jsonData) {
                    // use response from php for data table
                    var data = google.visualization.arrayToDataTable(jsonData);
                    chart.draw(data, options);
        
                    // draw again in 5 seconds
                    window.setTimeout(drawChart, 2000);
                  });
                }
              });
            }
            
            function actualizar_datos() {
                $.ajax({
                  url: 'monitoreo_php/cardregistros.php',
                  type: 'POST',
                  dataType: 'json',
                  success: function(data) {
                    $(".cant-registros").html(data.id);
                    $(".fecha-registro").html(data.fecha_registro);
                  },
                  error: function() {
                    console.log('Error al obtener los datos.');
                  }
                });
              }
        </script>

        <div class="rightbar-overlay"></div>
        <!-- /End-bar -->

        <script src="assets/js/maps.js"></script>

        <!-- bundle -->
        <script src="assets/js/vendor.min.js"></script>
        <script src="assets/js/app.min.js"></script>

        <!-- third party js 
        <script src="assets/js/vendor/apexcharts.min.js"></script>
        -->
        <script src="assets/js/vendor/jquery-jvectormap-1.2.2.min.js"></script>
        <script src="assets/js/vendor/jquery-jvectormap-world-mill-en.js"></script>
        <!-- third party js ends -->

        <!-- demo app -->
        <script src="assets/js/pages/demo.dashboard.js"></script>
        <!-- end demo js-->
    </body>
</html>